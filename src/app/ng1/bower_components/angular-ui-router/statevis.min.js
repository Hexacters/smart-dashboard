(function(){var a=angular.module("ct.ui.router.extras.examples.statevis",["ct.ui.router.extras"]);angular.module("ct.ui.router.extras.examples.statevis").directive("stateVis",["$state","$timeout","$interval","$futureState",function(d,c,e,b){return{scope:{width:"@",height:"@"},restrict:"AE",template:"<svg></svg>",link:function(s,n,h){var r={};var t=s.width||400,p=s.height||400;var o=d3.layout.tree().size([t-20,p-20]).separation(function(A,z){return A.parent==z.parent?10:25});var x=angular.copy(_.find(d.get(),function(z){return z.name===""}));var u=o(x);x.parent=x;x.px=x.x=t/2;x.py=x.y=p/2;var g={};g.px=g.x=x.px;g.py=g.y=x.py;var w=d3.svg.diagonal();var q=d3.select(n.find("svg")[0]).attr("width",t).attr("height",p).append("g").attr("transform","translate(10, 10)");var v=q.selectAll(".node"),k=q.selectAll(".link"),j=q.selectAll(".active");var y=200,f=200,m=setInterval(l,y);function i(z){z=z.map(function(A){return A.name==""?x:angular.copy(A)});_.extend(r,z.reduce(function(B,A){B[A.name]=A;return B},{}));z.forEach(function(B){var C=B.name.split(/\./).slice(0,-1).join(".");var A=B.name!=C&&r[C];if(A){(A.children||(A.children=[])).push(B);B.px=A.px;B.py=A.py;u.push(B)}})}e(function(){s.states=d.get();_.each(u,function(A){var z=d.get(A.name);if(z){A.status=z.status||"exited"}})},250);s.$watchCollection("states",function(B,A){var z=_.map(A,function(C){return C.name});i(_.reject(B,function(C){return _.contains(z,C.name)}))});l(y);function l(){v=v.data(o.nodes(x),function(D){return D.name});k=k.data(o.links(u),function(D){return D.target.name});j=j.data(g);u.forEach(function(D){D.y=D.depth*70});var B=v.enter();function C(E){var D=E.name.split(".").pop();if(E.sticky){D+=" (STICKY)"}if(E.deepStateRedirect){D+=" (DSR)"}return D}j.enter().append("circle").attr("class","active").attr("r",13).attr("cx",function(D){return D.parent.px||100}).attr("cy",function(D){return D.parent.py||100});B.append("circle").attr("class","node").attr("r",9).attr("cx",function(D){return D.parent.px}).attr("cy",function(D){return D.parent.py});B.append("text").attr("class","label").attr("x",function(D){return D.parent.px}).attr("y",function(D){return D.parent.py}).attr("text-anchor",function(D){return"middle"}).text(C).style("fill-opacity",1);k.enter().insert("path",".node").attr("class","link").attr("d",function(E){var D={x:E.source.px,y:E.source.py};return w({source:D,target:D})});var A=q.transition().duration(f);A.selectAll(".link").attr("d",w);var z={entered:"#AF0",exited:"#777",active:"#0f0",inactive:"#55F",future:"#009"};A.selectAll(".node").attr("cx",function(D){return D.px=D.x}).attr("cy",function(D){return D.py=D.y}).attr("r",function(D){return D.status==="active"?15:10}).style("fill",function(D){return z[D.status]||"#FFF"});A.selectAll(".label").attr("x",function(D){return D.px=D.x}).attr("y",function(D){return D.py=D.y-15}).attr("transform",function(D){return"rotate(-25 "+D.x+" "+D.y+")"});A.selectAll(".active").attr("x",function(D){return D.px=D.x}).attr("y",function(D){return D.py=D.y-15})}}}}])})();