(function(h,p,g){p.module("ct.ui.router.extras",["ui.router"]);var f=false;var w=p.forEach;var x=p.extend;var m=p.isArray;var C=function(F,G){var E=[];w(F,function(I,H){E.push(G(I,H))});return E};var o=function(E){return C(E,function(G,F){return F})};var n=function(F,G){var E=[];w(F,function(I,H){if(G(I,H)){E.push(I)}});return E};var i=function(F,G){var E={};w(F,function(I,H){if(G(I,H)){E[H]=I}});return E};function d(G,E){var F=[];for(var H in G.path){if(G.path[H]!==E.path[H]){break}F.push(G.path[H])}return F}function A(F){if(Object.keys){return Object.keys(F)}var E=[];p.forEach(F,function(H,G){E.push(G)});return E}function t(H,F){if(Array.prototype.indexOf){return H.indexOf(F,Number(arguments[2])||0)}var E=H.length>>>0,G=Number(arguments[2])||0;G=(G<0)?Math.ceil(G):Math.floor(G);if(G<0){G+=E}for(;G<E;G++){if(G in H&&H[G]===F){return G}}return -1}function D(L,H,E,K){var M=d(E,K),N,I={},J=[];for(var G in M){if(!M[G].params){continue}N=m(M[G].params)?M[G].params:A(M[G].params);if(!N.length){continue}for(var F in N){if(t(J,N[F])>=0){continue}J.push(N[F]);I[N[F]]=L[N[F]]}}return x({},I,H)}function v(F,E){return x(new (x(function(){},{prototype:F}))(),E)}var r;function c(){r=g}p.module("ct.ui.router.extras").config(["$provide",function(F){var E;F.decorator("$state",["$delegate","$q",function(H,G){E=H.transitionTo;H.transitionTo=function(K,J,I){if(I&&I.ignoreDsr){r=I.ignoreDsr}return E.apply(H,arguments).then(function(L){c();return L},function(L){c();return G.reject(L)})};return H}])}]);p.module("ct.ui.router.extras").service("$deepStateRedirect",["$rootScope","$state","$injector",function(L,E,M){var G={};var H={};var N="Redirect",O="AncestorRedirect";function F(Q){var P=Q.name;if(H.hasOwnProperty(P)){return H[P]}J(P)}function K(Q){var R=Q.deepStateRedirect;if(!R){return{dsr:false}}var P={dsr:true};if(p.isFunction(R)){P.fn=R}else{if(p.isObject(R)){P=p.extend(P,R)}}if(!P.fn){P.fn=["$dsr$",function(S){return S.redirect.state!=S.to.state}]}return P}function J(T){var S=E.get(T);if(!S){return false}var P=K(S);if(P.dsr){H[S.name]=N;if(G[T]===g){G[T]={}}}var R=S.$$state&&S.$$state().parent;if(R){var Q=J(R.self.name);if(Q&&H[S.name]===g){H[S.name]=O}}return H[S.name]||false}function I(S,R){function P(T){return !T?T:T.toString()}if(R===true){R=Object.keys(S)}if(R===null||R===g){R=[]}var Q={};p.forEach(R.sort(),function(T){Q[T]=P(S[T])});return p.toJson(Q)}L.$on("$stateChangeStart",function(P,W,Y,Q,U){if(r||F(W)!==N){return}var T=K(W);var V=I(Y,T.params);var S=G[W.name][V];if(!S){return}var R={redirect:{state:S.state,params:S.params},to:{state:W.name,params:Y}};var X=M.invoke(T.fn,W,{$dsr$:R});if(!X){return}if(X.state){S=X}P.preventDefault();E.go(S.state,S.params)});L.$on("$stateChangeSuccess",function(U,P,T,V,S){var R=F(P);if(R){var Q=P.name;p.forEach(G,function(Z,X){var W=K(E.get(X));var Y=I(T,W.params);if(Q==X||Q.indexOf(X+".")!=-1){G[X][Y]={state:Q,params:p.copy(T)}}})}});return{reset:function(P){if(!P){p.forEach(G,function(S,R){G[R]={}})}else{var Q=E.get(P);if(!Q){throw new Error("Unknown state: "+P)}if(G[Q.name]){G[Q.name]={}}}}}}]);p.module("ct.ui.router.extras").run(["$deepStateRedirect",function(E){}]);l.$inject=["$stateProvider"];function l(H){var E={};var F={};var G;this.registerStickyState=function(I){F[I.name]=I};this.enableDebug=function(I){f=I};this.$get=["$rootScope","$state","$stateParams","$injector","$log",function(P,I,Q,R,U){function T(){var V={};p.forEach(E,function(aa,W){var Z=L(aa);for(var X=0;X<Z.length;X++){var Y=Z[X].parent;V[Y.name]=V[Y.name]||[];V[Y.name].push(aa)}if(V[""]){V.__inactives=V[""]}});return V}function L(W){var V=[];if(!W){return V}do{if(W.sticky){V.push(W)}W=W.parent}while(W);V.reverse();return V}function J(Y,W,V){if(Y[V]===W[V]){return{from:false,to:false}}var X=V<Y.length&&Y[V].self.sticky;var Z=V<W.length&&W[V].self.sticky;return{from:X,to:Z}}function K(Y,V,X){if(X){return"updateStateParams"}var Z=E[Y.self.name];if(!Z){return"enter"}var W=S(V,Z.locals.globals.$stateParams,Y.ownParams);return W?"reactivate":"updateStateParams"}function N(X,V){var Y=E[X.name];if(!Y){return null}if(!V){return Y}var W=S(V,Y.locals.globals.$stateParams,X.ownParams);return W?Y:null}function S(W,V,Z){if(!Z){Z=[];for(var aa in W){Z.push(aa)}}for(var Y=0;Y<Z.length;Y++){var X=Z[Y];if(W[X]!=V[X]){return false}}return true}var O={getInactiveStates:function(){var V=[];p.forEach(E,function(W){V.push(W)});return V},getInactiveStatesByParent:function(){return T()},processTransition:function(ak){var ad={inactives:[],enter:[],exit:[],keep:0};var ab=ak.fromState.path,ai=ak.fromParams,ah=ak.toState.path,af=ak.toParams,Y=ak.options;var aj=0,aa=ah[aj];if(Y&&Y.inherit){af=D(Q,af||{},I.$current,ak.toState)}while(aa&&aa===ab[aj]&&S(af,ai,aa.ownParams)){aa=ah[++aj]}ad.keep=aj;var ag,an,Z,X={},ae=J(ab,ah,aj);var ac=false;for(ag=aj;ag<ah.length;ag++){var W=!ae.to?"enter":K(ah[ag],ak.toParams,ac);ac=(ac||W=="updateStateParams");ad.enter[ag]=W;if(W=="reactivate"){Z=X[ah[ag].name]=ah[ag]}if(W=="updateStateParams"){an=ah[ag]}}Z=Z?Z.self.name+".":"";an=an?an.self.name+".":"";var V=T();var al=[""].concat(C(ab.slice(0,aj),function(ao){return ao.self.name}));p.forEach(al,function(ao){var aq=V[ao];for(var ap=0;aq&&ap<aq.length;ap++){var ar=aq[ap];if(!X[ar.name]&&(!Z||(ar.self.name.indexOf(Z)!==0))&&(!an||(ar.self.name.indexOf(an)!==0))){ad.inactives.push(ar)}}});for(ag=aj;ag<ab.length;ag++){var am="exit";if(ae.from){ad.inactives.push(ab[ag]);am="inactivate"}ad.exit[ag]=am}return ad},stateInactivated:function(V){E[V.self.name]=V;V.self.status="inactive";if(V.self.onInactivate){R.invoke(V.self.onInactivate,V.self,V.locals.globals)}},stateReactivated:function(V){if(E[V.self.name]){delete E[V.self.name]}V.self.status="entered";if(V.self.onReactivate){R.invoke(V.self.onReactivate,V.self,V.locals.globals)}},stateExiting:function(W,Y,V){var X={};p.forEach(Y,function(Z){X[Z.self.name]=true});p.forEach(E,function(aa,Z){if(!X[Z]&&aa.includes[W.name]){if(f){U.debug("Exiting "+Z+" because it's a substate of "+W.name+" and wasn't found in ",X)}if(aa.self.onExit){R.invoke(aa.self.onExit,aa.self,aa.locals.globals)}p.forEach(aa.locals,function(ab,ac){delete y.locals[ac]});aa.locals=null;aa.self.status="exited";delete E[Z]}});if(V){R.invoke(V,W.self,W.locals.globals)}W.locals=null;W.self.status="exited";delete E[W.self.name]},stateEntering:function(Z,Y,V){var X=N(Z);if(X&&!N(Z,Y)){var W=Z.locals;this.stateExiting(X);Z.locals=W}Z.self.status="entered";if(V){R.invoke(V,Z.self,Z.locals.globals)}},reset:function M(X,Y){var W=I.get(X);var V=N(W,Y);if(!V){return false}O.stateExiting(V);P.$broadcast("$viewContentLoading");return true}};return O}]}p.module("ct.ui.router.extras").provider("$stickyState",l);var j;var u={};var s,z=[],B,y,k={hasParamSet:false};function b(E){return{resolve:{},locals:{globals:s&&s.locals&&s.locals.globals},views:{},self:{},params:{},ownParams:(k.hasParamSet?{$$equals:function(){return true}}:[]),surrogateType:E}}p.module("ct.ui.router.extras").run(["$stickyState",function(E){j=E}]);p.module("ct.ui.router.extras").config(["$provide","$stateProvider","$stickyStateProvider","$urlMatcherFactoryProvider",function(F,H,I,G){k.hasParamSet=!!G.ParamSet;y=p.extend(new b("__inactives"),{self:{name:"__inactives"}});s=B=g;z=[];H.decorator("parent",function(K,J){u[K.self.name]=K;K.self.$$state=function(){return u[K.self.name]};if(K.self.sticky===true){I.registerStickyState(K.self)}return J(K)});var E;F.decorator("$state",["$delegate","$log","$q",function(K,L,J){s=K.$current;u[""]=s;s.parent=y;y.parent=g;s.locals=v(y.locals,s.locals);delete y.locals.globals;E=K.transitionTo;K.transitionTo=function(P,ae,T){if(!y.locals){y.locals=s.locals}var af=z.length;if(B){B();if(f){L.debug("Restored paths from pending transition")}}var R=K.$current,ap=K.params;var Q=T&&T.relative||K.$current;var ai=K.get(P,Q);var ad,V,aj;var Z=[],ab=[],M;var U=function(){};var ao=function(){if(ad){ah.path=ad;ad=null}if(V){R.path=V;V=null}p.forEach(ao.restoreFunctions,function(aw){aw()});ao=U;B=null;z.splice(af,1)};ao.restoreFunctions=[];ao.addRestoreFunction=function an(aw){this.restoreFunctions.push(aw)};function av(aw){var ax=p.extend(new b("reactivate_phase1"),{locals:aw.locals});ax.self=p.extend({},aw.self);return ax}function at(ax){var ay=p.extend(new b("reactivate_phase2"),ax);var aw=ay.self.onEnter;ay.resolve={};ay.views={};ay.self.onEnter=function(){ay.locals=ax.locals;j.stateReactivated(ax)};ao.addRestoreFunction(function(){ax.self.onEnter=aw});return ay}function W(ax){var ay=new b("inactivate");ay.self=ax.self;var aw=ax.self.onExit;ay.self.onExit=function(){j.stateInactivated(ax)};ao.addRestoreFunction(function(){ax.self.onExit=aw});return ay}function aq(ay,ax){var aw=ay.self.onEnter;ay.self.onEnter=function(){j.stateEntering(ay,ax,aw)};ao.addRestoreFunction(function(){ay.self.onEnter=aw});return ay}function Y(ax){var aw=ax.self.onExit;ax.self.onExit=function(){j.stateExiting(ax,ab,aw)};ao.addRestoreFunction(function(){ax.self.onExit=aw});return ax}if(ai){var ah=u[ai.name];if(ah){ad=ah.path;V=R.path;var aa={toState:ah,toParams:ae||{},fromState:R,fromParams:ap||{},options:T};z.push(aa);B=ao;aj=j.processTransition(aa);if(f){a(L,aa,aj)}var X=ah.path.slice(0,aj.keep);var S=R.path.slice(0,aj.keep);p.forEach(y.locals,function(ax,aw){if(aw.indexOf("@")!=-1){delete y.locals[aw]}});for(var am=0;am<aj.inactives.length;am++){var O=aj.inactives[am].locals;p.forEach(O,function(aw,ax){if(O.hasOwnProperty(ax)&&ax.indexOf("@")!=-1){y.locals[ax]=aw}})}p.forEach(aj.enter,function(ax,aw){var ay;if(ax==="reactivate"){ay=av(ah.path[aw]);X.push(ay);S.push(ay);Z.push(at(ah.path[aw]));M=ay}else{if(ax==="updateStateParams"){ay=aq(ah.path[aw]);X.push(ay);M=ay}else{if(ax==="enter"){X.push(aq(ah.path[aw]))}}}});p.forEach(aj.exit,function(ay,aw){var ax=R.path[aw];if(ay==="inactivate"){S.push(W(ax));ab.push(ax)}else{if(ay==="exit"){S.push(Y(ax));ab.push(ax)}}});if(Z.length){p.forEach(Z,function(aw){X.push(aw)})}if(M){var ak=M.self.name+".";var ag=j.getInactiveStates();var N=[];ag.forEach(function(aw){if(aw.self.name.indexOf(ak)===0){N.push(aw)}});N.sort();N.reverse();S=S.concat(C(N,function(aw){return Y(aw)}));ab=ab.concat(N)}ah.path=X;R.path=S;var ar=function(aw){return(aw.surrogateType?aw.surrogateType+":":"")+aw.self.name};if(f){L.debug("SurrogateFromPath: ",C(S,ar))}if(f){L.debug("SurrogateToPath:   ",C(X,ar))}}}var ac=E.apply(K,arguments);return ac.then(function al(aw){ao();if(f){e(L,u[aw.name],K)}aw.status="active";return aw},function au(aw){ao();if(f&&aw.message!=="transition prevented"&&aw.message!=="transition aborted"&&aw.message!=="transition superseded"){L.debug("transition failed",aw);console.log(aw.stack)}return J.reject(aw)})};return K}])}]);function a(H,L,K){function G(O,M,N){return(O[M]?O[M].toUpperCase()+": "+N.self.name:"("+N.self.name+")")}var F=C(K.inactives,function(M){return M.self.name});var J=C(L.toState.path,function(N,M){return G(K.enter,M,N)});var I=C(L.fromState.path,function(N,M){return G(K.exit,M,N)});var E=L.fromState.self.name+": "+p.toJson(L.fromParams)+":  -> "+L.toState.self.name+": "+p.toJson(L.toParams);H.debug("   Current transition: ",E);H.debug("Before transition, inactives are:   : ",C(j.getInactiveStates(),function(M){return M.self.name}));H.debug("After transition,  inactives will be: ",F);H.debug("Transition will exit:  ",I);H.debug("Transition will enter: ",J)}function e(K,I,F){K.debug("Current state: "+I.self.name+", inactive states: ",C(j.getInactiveStates(),function(M){return M.self.name}));var E=function(N,M){return"'"+M+"' ("+N.$$state.name+")"};var H=function(N,M){return M!="globals"&&M!="resolve"};var L=function(N){var M=C(i(N.locals,H),E).join(", ");return"("+(N.self.name?N.self.name:"root")+".locals"+(M.length?": "+M:"")+")"};var J=L(I);var G=I.parent;while(G&&G!==I){if(G.self.name===""){J=L(F.$current.path[0])+" / "+J}J=L(G)+" / "+J;I=G;G=I.parent}K.debug("Views: "+J)}p.module("ct.ui.router.extras").provider("$futureState",["$stateProvider","$urlRouterProvider","$urlMatcherFactoryProvider",function q(F,I,P){var O={},J={};var L=false,Q=[],G,T=false;var S=this;this.addResolve=function(V){Q.push(V)};this.stateFactory=function(V,W){O[V]=W};this.futureState=function(aa){if(aa.stateName){aa.name=aa.stateName}if(aa.urlPrefix){aa.url="^"+aa.urlPrefix}J[aa.name]=aa;var X,Z=aa.name.split(/\./).slice(0,-1).join("."),V=N(aa.parent||Z);if(V){X=V.url||V.navigable.url}else{if(Z===""){X=P.compile("")}else{var W=N((aa.parent||Z),true);if(!W){throw new Error("Couldn't determine parent state of future state. FutureState:"+p.toJson(aa))}var Y=W.urlMatcher.source.replace(/\*rest$/,"");X=P.compile(Y);aa.parentFutureState=W}}aa.urlMatcher=aa.url.charAt(0)==="^"?P.compile(aa.url.substring(1)+"*rest"):X.concat(aa.url+"*rest")};this.get=function(){return p.extend({},J)};function N(W,V){var X=p.isObject(W)?W.name:W;return !V?u[X]:J[X]}function U(V,ad){if(ad.name){var ab=ad.name.split(/\./);if(ad.name.charAt(0)==="."){ab[0]=V.current.name}while(ab.length){var ac=ab.join(".");if(V.get(ac,{relative:V.current})){return null}if(J[ac]){return J[ac]}ab.pop()}}if(ad.url){var aa=[];for(var X in J){if(J[X].urlMatcher.exec(ad.url)){aa.push(J[X])}}var W=aa.slice(0);for(var Z=aa.length-1;Z>=0;Z--){for(var Y=0;Y<W.length;Y++){if(aa[Z]===W[Y].parentFutureState){aa.splice(Z,1)}}}return aa[0]}}function M(aa,ab){var X=aa.get("$q");if(!ab){var W=X.defer();W.reject("No lazyState passed in "+ab);return W.promise}var ac=X.when([]),Y=ab.parentFutureState;if(Y&&J[Y.name]){ac=M(aa,J[Y.name])}var Z=ab.type;var V=O[Z];if(!V){throw Error("No state factory for futureState.type: "+(ab&&ab.type))}return ac.then(function(ae){var ad=aa.invoke(V,V,{futureState:ab});return ad.then(function(af){if(af){ae.push(af)}return ae})})["finally"](function(){delete (J[ab.name])})}var H=["$log","$location",function H(V,W){V.debug("Unable to map "+W.path())}];function K(W,Z){var X=false;var Y=["$rootScope","$urlRouter","$state",function Y(aa,ad,ae){if(!T){G().then(function ag(){X=true;ad.sync();X=false});T=true;return}var af=U(ae,{url:Z.path()});if(!af){return W.invoke(H)}L=true;M(W,af).then(function ac(ah){ah.forEach(function(ai){if(ai&&(!ae.get(ai)||(ai.name&&!ae.get(ai.name)))){F.state(ai)}});X=true;ad.sync();X=false;L=false},function ab(){L=false;return W.invoke(H)})}];if(L){return}var V=X?H:Y;return W.invoke(V)}I.otherwise(K);I.otherwise=function(V){if(p.isString(V)){var W=V;V=function(){return W}}else{if(!p.isFunction(V)){throw new Error("'rule' must be a function")}}H=V;return I};var R={getResolvePromise:function(){return G()}};this.$get=["$injector","$state","$q","$rootScope","$urlRouter","$timeout","$log",function E(aa,Z,W,V,X,Y,ab){function ac(){V.$on("$stateNotFound",function ad(ai,ah,al,ag){if(L){return}ab.debug("event, unfoundState, fromState, fromParams",ai,ah,al,ag);var aj=U(Z,{name:ah.to});if(!aj){return}ai.preventDefault();L=true;var ak=M(aa,aj);ak.then(function(am){am.forEach(function(an){if(an&&(!Z.get(an)||(an.name&&!Z.get(an.name)))){F.state(an)}});Z.go(ah.to,ah.toParams);L=false},function(am){console.log("failed to lazy load state ",am);Z.go(al,ag);L=false})});if(!G){var ae=[];p.forEach(Q,function(ag){ae.push(aa.invoke(ag))});G=function(){return W.all(ae)}}G().then(function af(){Y(function(){if(Z.transition){Z.transition.then(X.sync,X.sync)}else{X.sync()}})})}ac();R.state=F.state;R.futureState=S.futureState;R.get=S.get;return R}]}]);p.module("ct.ui.router.extras").run(["$futureState",function(E){}]);p.module("ct.ui.router.extras").service("$previousState",["$rootScope","$state",function(E,F){var G=null;var J={};var I=null;E.$on("$stateChangeStart",function(L,K,O,N,M){I=G;G={state:N,params:M}});E.$on("$stateChangeError",function(){G=I;I=null});E.$on("$stateChangeSuccess",function(){I=null});var H={get:function(K){return K?J[K]:G},go:function(K,L){var M=H.get(K);return F.go(M.state,M.params,L)},memo:function(K,L,M){J[K]=G||{state:F.get(L),params:M}},forget:function(K){delete J[K]}};return H}]);p.module("ct.ui.router.extras").run(["$previousState",function(E){}]);p.module("ct.ui.router.extras").config(["$provide",function(E){E.decorator("$state",["$delegate","$rootScope","$q","$injector",function(H,O,M,P){var I=H.transitionTo;var N=-1;var Q=[];var K=[];function J(S){var R=P.invoke;var U=P.instantiate;P.invoke=function(W,V,X){return R(W,V,p.extend({$transition$:S},X))};P.instantiate=function(V,W){return U(V,p.extend({$transition$:S},W))};return function T(){P.invoke=R;P.instantiate=U}}function G(){K.pop()();Q.pop();N--}function F(S,T){return function R(U){G();O.$broadcast("$transitionSuccess",T);return S.resolve(U)}}function L(S,R){return function T(U){G();O.$broadcast("$transitionError",R,U);return S.reject(U)}}H.transitionTo=function(W,T,S){var R=M.defer();var V=Q[++N]={promise:R.promise};K[N]=function(){};var U=I.apply(H,arguments);return U.then(F(R,V),L(R,V))};O.$on("$stateChangeStart",function(T,S,V,Y,U){var X=N;var W=p.extend(Q[X],{to:{state:S,params:V},from:{state:Y,params:U}});var R=J(W);K[X]=R;O.$broadcast("$transitionStart",W)});return H}])}])})(window,window.angular);